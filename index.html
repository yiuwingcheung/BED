<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BED and EQD2 Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 10px;
            background-color: #f9f9f9;
        }
        h1 {
            font-size: 1.5em;
            text-align: center;
        }
        label {
            display: block;
            margin: 10px 0 5px;
        }
        input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        #results, #newDoseResult {
            background-color: #e7f3fe;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            text-align: left; /* Align output text to the left */
        }
    </style>
</head>
<body>
    <h1>BED and EQD2 Calculator</h1>
    
    <label for="alphaBeta">Alpha/Beta Ratio (Gy):</label>
    <input type="number" id="alphaBeta" required oninput="calculateBED()" placeholder="Enter α/β ratio">

    <label for="totalDose">Total Dose (Gy):</label>
    <input type="number" id="totalDose" required oninput="calculateBED()" placeholder="Enter total dose">

    <label for="fractions">Number of Fractions:</label>
    <input type="number" id="fractions" required oninput="calculateBED()" placeholder="Enter number of fractions">

    <p id="results"></p>
    
    <label for="newFractions">New Number of Fractions:</label>
    <input type="number" id="newFractions" oninput="calculateNewDose()" placeholder="Enter new number of fractions">

    <p id="newDoseResult"></p>

    <script>
        let currentBED = 0;

        function calculateBED() {
            const alphaBeta = parseFloat(document.getElementById('alphaBeta').value);
            const totalDose = parseFloat(document.getElementById('totalDose').value);
            const fractions = parseInt(document.getElementById('fractions').value);

            if (!isNaN(alphaBeta) && !isNaN(totalDose) && !isNaN(fractions) && fractions > 0) {
                const dosePerFraction = totalDose / fractions;
                currentBED = fractions * dosePerFraction * (1 + (dosePerFraction / alphaBeta));
                const EQD2 = currentBED / (1 + (2 / alphaBeta));

                document.getElementById('results').innerHTML =
                    `BED: ${currentBED.toFixed(2)} Gy<br>EQD2: ${EQD2.toFixed(2)} Gy`;
            } else {
                document.getElementById('results').innerHTML = '';
            }
        }

        function calculateNewDose() {
            const newFractions = parseInt(document.getElementById('newFractions').value);
            const alphaBeta = parseFloat(document.getElementById('alphaBeta').value);

            if (!isNaN(newFractions) && newFractions > 0 && currentBED > 0 && !isNaN(alphaBeta)) {
                const A = 1; // Coefficient for D^2
                const B = newFractions * (alphaBeta); // Coefficient for D
                const C = -newFractions * (alphaBeta) * currentBED; // Constant term

                // Solve the quadratic equation A*D^2 + B*D + C = 0
                const discriminant = B * B - 4 * A * C;
                if (discriminant >= 0) {
                    const D1 = (-B + Math.sqrt(discriminant)) / (2 * A);
                    const D2 = (-B - Math.sqrt(discriminant)) / (2 * A);
                    const newTotalDose = D1 > 0 ? D1 : D2; // Take the positive root

                    document.getElementById('newDoseResult').innerHTML =
                        `New Total Dose: ${newTotalDose.toFixed(2)} Gy`;
                } else {
                    document.getElementById('newDoseResult').innerHTML = 'No valid solution for the new total dose.';
                }
            } else {
                document.getElementById('newDoseResult').innerHTML = '';
            }
        }
    </script>
</body>
</html>
